"use strict";var t,u,s,w,x,y,O,R,S,N,_,J,A;t=function(t){return document.querySelector(t)},u=chrome.extension.getBackgroundPage(),s=chrome.i18n.getMessage,w=document.querySelectorAll.bind(document),(x=chrome.i18n.getMessage("lang1"))&&(function(){var n,i,e,o,u=s("keyMappingsP"),r=t("#keyMappings");for(u&&r&&(r.placeholder=u),n=0,i=w("[data-i]");n<i.length;n++)((u=s((r=i[n]).dataset.i))||r.dataset.iE)&&(r.innerText=u);for(e=0,o=w("[data-i-t]");e<o.length;e++)(u=s((r=o[e]).dataset.iT))&&(r.title=u);document.documentElement.lang=x,(u=s("vOptions"))&&(document.title=u)})(),y=function(t,n){var i=function(){this.constructor=t};i.prototype=n.prototype,t.prototype=new i},O=(function(){var t=[],n=function(){var i,e,o=t.length;for(i=0,e=t;i<e.length;i++)(0,e[i])();t.length>o?(t.splice(0,o),Promise.resolve().then(n)):t.length=0};return function(i,e){t.length<=0&&Promise.resolve().then(n),9===e?t.unshift(i):t.push(e?i.bind(null,e):i)}})(),R=function(t,n,i,e){var o,u=0,r=function(){var s=Date.now()-o;if(!(s<n-4&&s>=0))return u=0,o!==e?t.call(i):void 0;u=setTimeout(r,n-s)};return e=e?1:0,function(){if(o=Date.now(),!u)return u=setTimeout(r,n),e?(e=o,t.call(i)):void 0}},S=u.f,N=u.l,_=(function(){function t(t,n){this.tu=t,this.nu=t.id,this.iu=this.eu=null,this.ou=false,this.nu in N.he&&(n=this.uu.bind(this,n)),this.eu=R(n,330,this,1)}return t.prototype.ru=function(){},t.prototype.su=function(){this.ou=true,this.iu=N.le(this.nu),t.cu||this.au(this.iu)},t.prototype.fu=function(t,n,i){var e=this.lu;return n?(i=e||!i?JSON.stringify(e?e.hu(t):t):i,u.JSON.parse(i)):e?e.hu(t):t},t.prototype.du=function(){return true},t.prototype.vu=function(){var n=this.mu(),i="object"==typeof n,e=i?JSON.stringify(this.iu):this.iu,o=i?JSON.stringify(n):n;o!==e&&(e=o,n=this.fu(n,i,i?o:""),i&&(o=JSON.stringify(n))===JSON.stringify(N.se[this.nu])&&(n=N.se[this.nu]),N.fe(this.nu,n),this.iu=n=N.le(this.nu),this.ou=true,(e!==(i?JSON.stringify(n):n)||this.pu(n))&&this.au(n,true),this.nu in N.he&&t.wu.push(this.nu),this.ru())},t.prototype.pu=function(){return false},t.xu=function(t,n){return JSON.stringify(t)===JSON.stringify(n)},t.Vo=Object.create(null),t.cu=true,t})(),J=(function(n){function i(e,o){var u,r,c,a,f,l,h=n.call(this,e,o)||this;if(h.gu=_.xu,h.k=e.querySelector("#exclusionTemplate").content.firstChild,x){for(u=void 0,r=void 0,c=0,a=e.querySelectorAll("[data-i]");c<a.length;c++)(r=s((u=a[c]).dataset.i))&&(u.innerText=r);for(f=0,l=h.k.querySelectorAll("[title]");f<l.length;f++)(r=s((u=l[f]).title))&&(u.title=r)}return h.yu=e.querySelector("tbody"),h.Rt=[],h.yu.addEventListener("input",i.Ou),h.yu.addEventListener("input",h.eu),h.yu.addEventListener("click",function(t){return h.bu(t)}),t("#exclusionAddButton").onclick=function(){return h.ku("")},_.wu&&(h.k.draggable=true),O(function(){return h.Ru&&h.Ru()}),h}return y(i,n),i.prototype.Su=function(){},i.Ou=function(t){var n=t.target.vnode;n&&(n.Nu=true)},i.prototype.ku=function(t,n){this._u(this.yu,{pattern:t,passKeys:""});var i=this.Rt[this.Rt.length-1];false!==n&&O(function(){return i.Ju.focus()}),t&&this.eu(),this.Su(1)},i.prototype.au=function(t){if(this.yu.textContent="",this.Rt=[],t.length<=0);else if(1===t.length)this._u(this.yu,t[0]);else{var n=document.createDocumentFragment();t.forEach(this._u.bind(this,n)),this.yu.appendChild(n)}return this.Su(t.length)},i.prototype.Au=function(){return true},i.prototype._u=function(t,n){var i,e,o,u,r,s=n.pattern,c=n.passKeys,a={Pu:{pattern:s,passKeys:c},Nu:false,hi:false,Ju:null,Tu:null};this.Au(s)?(e=(i=document.importNode(this.k,true)).querySelector(".pattern"),o=i.querySelector(".passKeys"),u=c.trimRight(),e.value=s,s&&(e.placeholder=""),o.value=u,u&&(o.placeholder=""),(r=a).hi=true,r.Ju=e,r.Tu=o,e.vnode=r,o.vnode=r,this.Rt.push(r),t.appendChild(i)):this.Rt.push(a)},i.$u=function(t){t.Pu.pattern&&t.Tu.placeholder&&(t.Tu.placeholder="")},i.prototype.bu=function(t){var n,i=t.target;if(i.classList.contains("exclusionRemove"))return(i=i.parentNode.parentNode).classList.contains("exclusionRule")?(n=i.querySelector(".pattern").vnode,i.remove(),this.Rt.splice(this.Rt.indexOf(n),1),this.eu(),this.Su(0)):void 0},i.ju=function(t,n,i){var e=i.toLowerCase();return i!==e?"<"+n+"s-"+e+">":t},i.Lu=function(t){return t&&t.replace(/<(?!<)((?:[acm]-){0,3})([^a-z\d][\dA-Z]*)>/g,i.ju)},i.prototype.mu=function(t){var n,e,o,u,r,s,c,a,f,l,h=[];for(t=true===t,n=0,e=this.Rt;n<e.length;n++)o=e[n],t&&!o.hi||(o.Nu?(u=o.Ju.value.trim(),r=false,s=o.Tu.value,u?((c=u.startsWith(":")?0:u.indexOf("://"))&&(/^[\^*]|[^\\][$()*+?\[\]{|}]/.test(u)?u.startsWith("^")||(r=!u.includes("/",c+3),u=(c<0?"^https?://":"^")+(u.startsWith("*")&&"."!==u[1]?"[^/]"+u:(u=u.replace(/\./g,"\\.")).startsWith("*")?u.replace("*\\.","(?:[^./]+\\.)*?"):u.replace("://*\\.","://(?:[^./]+\\.)*?"))):(r=!u.includes("/",c+3)&&!u.startsWith("vimium:"),u=(c<0?":http://":":")+(u=u.replace(/\\(.)/g,"$1")))),r&&(u+="/"),s&&((a=(s=i.Lu(s)).match(/<(?!<)(?:a-)?(?:c-)?(?:m-)?(?:s-)?(?:[a-z][\da-z]+|[^\sA-Z])>|\S/g))&&((f="^"===a[0]&&a.length>1)&&a.shift(),a.sort(),f?a.unshift("^"):"^"===a[0]&&(a.shift(),a.push("^"))),s=(s=a?a.join(" ")+" ":"").replace(/<escape>/gi,"<esc>")),o.Tu.title!==(l=s?s.length>1&&"^"===s[0]?"only hook such keys":"pass through such keys":"completely disabled")&&(o.Tu.title=l),this.Ku(o,u,s),h.push(o.Pu)):this.Ku(o,"",s)):o.Pu.pattern&&h.push(o.Pu));return h},i.prototype.Ku=function(t,n,e){var o=!t.Pu.passKeys&&!!e;t.Pu={pattern:n,passKeys:e},t.Nu=false,o&&i.$u(t)},i.prototype.ru=function(){var t,n,i,e;for(t=0,n=this.Rt;t<n.length;t++)(i=n[t]).hi&&(i.Ju.value!==i.Pu.pattern&&(i.Ju.value=i.Pu.pattern),e=i.Pu.passKeys.trim(),i.Tu.value!==e&&(i.Tu.value=e))},i})(_),A=S<48||devicePixelRatio<2&&S>=61?function(){var t=document.createElement("style"),n=devicePixelRatio,i=S>=61&&n>=1,e=i||S>=48?1/n:1;e=(""+(e+=999e-8)).slice(0,7).replace(/\.?0+$/,""),t.textContent=i?"input, textarea { border-width: "+e+"px; }":"* { border-width: "+e+"px !important; }",document.head.appendChild(t)}:null,location.pathname.toLowerCase().includes("/popup.html")&&Promise.all([u.r.pn("Exclusions"),u.r.Bn(1),N.Ue&&N.Ue()]).then((function(t){return function(){chrome.tabs.query({currentWindow:true,active:true},t)}})(function(n){function i(t){var n,i,e=3===j,o=e?m.g(R,p):m.d(R,p,B.mu(true));o&&(o=(function(t){var n,i,e,o;for((n=(t=t.trim()).length>2&&t.startsWith("^"))&&(t=t.slice(1).trimLeft()),i=Object.create(null),e=0,o=t.split(" ");e<o.length;e++)i[o[e]]=1;return(n?"^ ":"")+Object.keys(i).sort().join(" ")})(o)),t&&(T=j>=2?o:null),j=2,n=o===T,i=!!o&&o.length>2&&"^"===o[0],x.textContent=(e?o?s("o137")+s(i?"o138":"o139"):s("o140"):s(n?"o141":"o142")+s(o?i?"o138":"o139":n?"o143":"o143_2")).replace(" to be","")+s("colon")+(o?s("NS"):""),b.className=o?"code":"fixed-width",b.textContent=o?i?o.slice(2):o:s(null!==o?"o144":"o145")+s("o146"),k.textContent=M&&!e&&n?s("o147",[s(0!==$?"o144":"o145")]):M?s("o148"):"",g.disabled=n,g.firstChild.data=s(n?"o115":"o115_2")}function e(){if(!g.disabled){var t=m.e;u.a.rr("reset silent",p.t),B.vu(),setTimeout(function(){m.e=t},50),j=3,i(true),g.firstChild.data=s("o115_3"),g.disabled=true,P=true}}function o(t,n){n&&n.preventDefault(),u.a.rr(t.toLowerCase(),p.t),window.close()}var r,c,a,f,l,h,d,v,m,p,w,x,g,b,k,R,S,P,T,$,j,L,K,z,D,E,U,M,W,Z,B,q=n[0],C=q.url,F=u.a.we(q.id),G=t("#blocked-msg"),H=!(F||q&&C&&"loading"===q.status&&/^(ht|s?f)tp/.test(C));if(H?(r=document.body,c=document.documentElement,r.innerText="",G.style.display="",G.querySelector(".version").textContent=N.$.De,a=G.querySelector("#refresh-after-install"),q&&C&&/^(ht|s?f)tp/i.test(C)||a.remove(),r.style.width="auto",r.appendChild(G),null==(l=(f=C.startsWith(location.protocol)&&!C.startsWith(location.origin)?new URL(C).host:"")?N.ae[f]:null)||l||((h=t("#injection-refused")).style.display="",h.nextElementSibling.remove(),t("#doAllowExt").onclick=function(){var t,n=N.le("extAllowList"),i=n.split("\n"),e=f;i.indexOf(e)<0&&(t=i.indexOf("# "+e)+1||i.indexOf("#"+e)+1,i.splice(t?t-1:i.length,t?1:0,e),n=i.join("\n"),N.fe("extAllowList",n)),this.onclick=null,chrome.tabs.query({active:true,currentWindow:true},function(t){var n=function(){return setTimeout(function(){return location.reload()},500),chrome.runtime.lastError};return t&&t[0]?chrome.tabs.reload(t[0].id,n):chrome.tabs.reload(n),chrome.runtime.lastError})}),c.classList.toggle("auto-dark",!!N.te.d),c.style.height=""):O(function(t){G.remove(),G=null;var n=document.documentElement.classList;n.toggle("auto-dark",!!N.te.d),n.toggle("less-motion",!!N.te.m),t.textContent=N.$.De},t(".version")),(d=t(".options-link")).href!==(v=N.$.We)&&(d.href=v),d.onclick=function(t){t.preventDefault();var n=u.Object.create(null);n.u=N.$.We,u.a.Fr(n),window.close()},!H){for(m=u.Exclusions,p=!F||F[0].s.i&&!u.r.G.test(F[0].s.u)?{i:0,a:q.incognito,s:0,f:0,t:q.id,u:C}:F[0].s,w=p.i&&((u.a.we(q.id,0)||{}).s||{}).u||"",x=t("#state-action"),g=t("#saveOptions"),k=(b=x.nextElementSibling).nextElementSibling,R=p.u,S=(function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return y(n,t),n.prototype.ku=function(i,e){t.prototype.ku.call(this,n.zu(),e)},n.prototype.Au=function(t){if(!t)return false;var n=m.e[t];return!(1===n.t?!R.startsWith(n.v)||w&&!w.startsWith(n.v):!n.v.test(R)||w&&!n.v.test(w))},n.prototype.au=function(e){var o,u,r,s;t.prototype.au.call(this,e),(o=this).au=null,document.documentElement.style.height="",n.prototype.Au=J.prototype.Au,u=o.Rt.filter(function(t){return t.hi}),j=(r=u.length>0)?2:1,r?(s=u[0].Tu,i(true)):(o.ku("",false),s=o.Rt[o.Rt.length-1].Tu),O(function(){return s.focus()})},n.prototype.Ku=function(n,i,e){var o,u,r=n.Pu.pattern===i;t.prototype.Ku.call(this,n,i,e),r||(o=m.l(i,""),u=n.Ju,(1===o.t?R.startsWith(o.v):o.v.test(R))?u.title=u.style.color="":(u.style.color="red",u.title="Red text means that the pattern does not\nmatch the current URL."))},n.zu=function(){var t=R.startsWith("http:")?"^https?://"+R.split("/",3)[2].replace(/[.[\]]/g,"\\$&")+"/":R.startsWith(location.origin)?":vimium:/"+new URL(R).pathname.replace("/pages",""):/^[^:]+:\/\/./.test(R)&&!R.startsWith("file:")?":"+R.split("/",3).join("/")+"/":":"+R;return n.zu=function(){return t},t},n})(J),P=true,T=null,$=-1,j=0,g.onclick=e,document.addEventListener("keyup",function(t){if(13===t.keyCode&&(t.ctrlKey||t.metaKey)&&(setTimeout(window.close,300),!P))return e()}),L=N.le("exclusionRules"),K=m.e=u.Object.create(null),z=m.Vr,D=0,E=L.length;D<E;D++)K[L[D].pattern]=z[D];U=2!==p.s?"Disable":"Enable",$=(M=!!(1&p.f))?p.s:-1,W=t("#toggleOnce"),Z=W.nextElementSibling,O(function(){W.firstElementChild.textContent=(s(U)||U)+(M?"":s("Once")),W.onclick=o.bind(null,U),b.id="state-value",M?(Z.classList.remove("hidden"),Z.firstElementChild.onclick=o.bind(null,"Reset")):Z.remove()}),N.te.o||window.addEventListener("keydown",function(t){t.altKey&&(88===t.keyCode||M&&90===t.keyCode)&&!(t.shiftKey||t.ctrlKey||t.metaKey)&&(t.preventDefault(),t.stopImmediatePropagation(),o(88===t.keyCode?U:"Reset"))}),_.cu=false,B=null,(B=new S(t("#exclusionRules"),function(){if(P){P=false;var n=t("#helpSpan");n&&(n.nextElementSibling.style.display="",n.remove()),g.removeAttribute("disabled"),g.firstChild.data=s("o115_2")}i(j<2)})).su(),window.onunload=function(){m.e=null,u.r.Bn(-1)},A&&O(A)}}));