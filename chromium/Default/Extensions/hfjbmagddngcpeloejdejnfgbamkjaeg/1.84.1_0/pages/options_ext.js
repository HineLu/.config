"use strict";function I(n){return new Date(+n-6e4*(new Date).getTimezoneOffset()).toJSON().slice(0,19).replace("T"," ")}function Q(n,t){return t&&("omniBlockList"===n||u.d.Xo([t]))?"$base64:"+btoa(encodeURIComponent(t).replace(/%([0-9A-F]{2})/g,function(n,t){return String.fromCharCode(parseInt(t,16))})):t}function X(n){return n instanceof Array&&(n=n.join("\n").trimRight()),(n=n.replace(/\r\n?/g,"\n")).replace(/^\$base64:(.*)/gm,function(n,t){try{return decodeURIComponent([].map.call(atob(t),function(n){return"%"+("00"+n.charCodeAt(0).toString(16)).slice(-2)}).join(""))}catch(n){}return n})}function q(n,e,o){var i,r,c,a,u,l,f,g,p,d,m,S,b,w,v,T=e.environment,h=T&&T.platform||"",y=T&&parseFloat(T.extension||0)||0,O=y>parseFloat(N.$.Me);if(h&&(h=(""+h).slice(0,10)),confirm(s("confirmImport",[s(true!==o?"backupFile":"recommendedFile"),y>1?s("fileVCVer").replace("*",""+y):"",(y>1?s("fileVCVer_2").replace("*",""+y):"")+(O?s("fileVCNewer"):""),h?s("filePlatform",[s(h)||h[0].toUpperCase()+h.slice(1)]):s("commonPlatform"),n?s("atTime",[I(n)]):s("before")]))){for(u in null==e.vimSync&&(r=(i=N.le("vimSync"))&&confirm(s("keepSyncing")),e.vimSync=r||null,i&&console.log("Before importing: You chose to",r?"keep settings synced.":"stop syncing settings.")),c=function(n,t,e,o){var i=arguments.length>3,r=i?o:e,s=["%s %c%s",n,"color:darkred",t];r="string"!=typeof r||r.length<=72?r:r.slice(0,71).trimRight()+"\u2026",i&&s.push(e),s.push(r),console.log.apply(console,s)},n>1e4?console.info("IMPORT settings saved at %c%s%c.","color:darkblue",I(n),"color:auto"):console.info("IMPORT settings:",o?"recommended.":"saved before."),(a=function(n){return n.split(" ").forEach(function(n){return delete e[n]})})("name time environment author description"),e)"@"===u[0]&&delete e[u];for(l=localStorage,f=N.se,g=_.Vo,p=l.length;0<=--p;)(u=l.key(p)).includes("|")||u in e||(e[u]=null);for(u in a("findModeRawQuery findModeRawQueryList innerCSS findCSS omniCSS newTabUrl_f hookAccessKeys vomnibarPage_f"),N.Pe)u in e&&(e[N.Pe[u]]=e[u],delete e[u]);for(m in e.vimSync!==N.le("vimSync")&&(c("import","vimSync",e.vimSync),N.fe("vimSync",e.vimSync),g.vimSync.su()),void 0!==(d=g.keyMappings)&&(delete g.keyMappings,g.keyMappings=d),g)if(b=e[u=(S=g[m]).nu],delete e[u],null==b?b=f[u]:("string"==typeof f[u]&&(b=X(b)),b=S.fu(b,"object"==typeof f[u])),S.gu(N.le(u),b)){if(S.ou)continue;S.su()}else c("import",u,b),N.fe(u,b),u in N.he&&_.wu.push(u),S.su(),S.ru&&S.ru();for(u in e)if(null!=(b=e[u]))"string"==typeof f[u]&&(b=X(b)),u in f?N.le(u)!==b&&(N.fe(u,b),c("update",u,b)):(l.setItem(u,b),c("save",u,b));else{if(u in f){if(b=f[u],N.le(u)!==b){N.fe(u,b),c("reset",u,b);continue}b=N.le(u)}else b=l.getItem(u);l.removeItem(u),c("remove",u,":=",b)}t("#saveOptions").onclick(false),t("#advancedOptionsButton").getAttribute("aria-checked")!==""+N.le("showAdvancedOptions")&&t("#advancedOptionsButton").onclick(null,true),console.info("IMPORT settings: finished."),(v=(w=window.VApi&&VApi.y().r)&&w.querySelector("#HCls"))&&(v.click(),t("#showCommands").click()),window.VApi&&VApi.t({k:102})}else window.VApi&&VApi.t({k:101})}function K(n,e,o){var i,r,c,a,l,f=null,g=null,p="";try{(i=Y(o?e:e.replace(/\xa0/g," ")))instanceof Error?g=i:i?f=i:p=s("notJSON")}catch(n){g=n}return null!=g&&(p=(r=/^(\d+):(\d+)$/.exec(p=g?(g.message||g)+"":s("exc")+(""!==g?g:s("unknown"))))?s("JSONParseError",[r[1],r[2]]):p),f?(n=+new Date(f&&f.time||("object"==typeof n?+n:n))||0,"Vimium C"!==f.name&&"Vimium++"!==f.name||n<1e4&&n>0?(p=s("notVCJSON"),alert(p)):(c=_.Vo.keyMappings.lu?1:new Promise(function(n){var e=t("script[src*=options_checker]")||B("options_checker.js"),o=function(){e.removeEventListener("load",o),n(1)};G.ns="",e.addEventListener("load",o)}),a=n,l=f,void Promise.all([u.r.pn("Commands"),u.r.pn("Exclusions"),c]).then(function(){setTimeout(q,17,a,l,o)}))):alert(p)}function Y(n){function t(){return/a?/.test("")}function e(n){for(var t=n.length;i.length<t;i+=i);return i.slice(0,t)}var o,i,r,s,c,a,u,l=/[^\r\n]+/g;if(!n||!(n=n.trimRight()))return null;i=" ";try{return r=JSON.parse(n.replace(/"(?:\\[\\\"]|[^"])*"|'(?:\\[\\\']|[^'])*'|\/\/[^\r\n]*|\/\*[^]*?\*\/|#[^\r\n]*/g,function(n){var t=n[0];return"/"===t||"#"===t?n.startsWith("/*")?n.replace(l,e):e(n):n})),t(),r}catch(n){if(o=/\b(?:position (\d+)|line (\d+) column (\d+))/.exec(n+""),t(),!o||!o[0])throw n}return o[2]?(s=+o[2],c=+o[3]):+o[1]>0?(a=n.includes("\r")?n.includes("\r\n")?"\r\n":"\r":"\n",c=(u=n.slice(0,+o[1]).split(a))[(s=u.length)-1].length+1):s=c=1,new SyntaxError(s+":"+c)}var Z,nn;t("#showCommands").onclick=function(n){var t,e,o;if(window.VApi&&VApi.z){if(e=VApi.y().r,n&&n.preventDefault(),e&&(t=e.querySelector("#HCls"))&&(o=null!=e.querySelector(".HelpCommandName"),E(t),o))return;VApi.p({H:12}),n||setTimeout(function(){var n=VApi.y(),t=n.r&&n.r.querySelector("#HDlg");t&&t.querySelector("#HCls").addEventListener("click",function(){location.hash=""})},100)}},J.prototype.u=function(n){var t,e,o,i,r,c,a,u,l;if(!n||!this.Wt){for(e=/^([:^]?[a-z\-?*]+:\/\/)?((?:[^\/]|\/])+)(\/[^\]].*|\/?$)/,o=/\\\./g,c=0,a=t=this.mu();c<a.length;c++)(r=e.exec(i=(u=a[c]).pattern.replace("(?:[^./]+\\.)*?","*.")))&&r[1]&&r[2]&&(i=r[3]?r[3].replace(o,"."):"",(r=r[2].replace(o,".").split(".")).reverse(),i=r.join(".")+i),u.et=i;t.sort(function(n,t){return n.et<t.et?-1:n.et===t.et?0:1}),this.au(t),this.eu(),n&&(l=this,this.Wt=setTimeout(function(n,t){n.firstChild.data=t,l.Wt=0},1e3,n,n.firstChild.data),n.firstChild.data=s("o3_2"))}},t("#exclusionSortButton").onclick=function(){return _.Vo.exclusionRules.u(this)},Z="",window.addEventListener("unload",function(){Z&&URL.revokeObjectURL(Z)}),t("#exportButton").onclick=function(n){var t,e,o,i,r,s,c,a,u,l,f,g,p,d,_,m,b;for(Z&&(URL.revokeObjectURL(Z),Z=""),e=!!n&&(n.ctrlKey||n.metaKey||n.shiftKey),o=new Date,(t=Object.create(null)).name="Vimium C",e||(t["@time"]=o.toLocaleString(),t.time=o.getTime()),t.environment={extension:N.$.Me,platform:N.$.Ge},t.environment.chrome=S,i=[],r=localStorage,s=N.se,c=0,a=r.length;c<a;c++)(u=r.key(c)).includes("|")||u.endsWith("_f")||"findModeRawQueryList"===u||u.endsWith("CSS")||i.push(u);for(i.sort(),l=function(n){var e=r.getItem(n);"string"!=typeof s[n]?t[n]=n in s?N.le(n):e:e.includes("\n")?(t[n]=e.split("\n")).push(""):t[n]=e,"string"==typeof s[n]&&(t[n]="string"==typeof t[n]?Q(n,t[n]):t[n].map(function(t){return Q(n,t)}))},f=0,g=i;f<g.length;f++)l(u=g[f]);p=JSON.stringify(t,null,"\t"),d=I(o),"win"===t.environment.platform&&(p=p.replace(/\n/g,"\r\n")),t=null,_="vimium_c-",_+=e?"settings":d.replace(/[\-:]/g,"").replace(" ","_"),_+=".json",m=new Blob([p],{type:"application/json",endings:"native"}),(b=document.createElement("a")).download=_,b.href=URL.createObjectURL(m),E(b),Z=b.href,console.info("EXPORT settings to %c%s%c at %c%s%c.","color:darkred",_,"color:auto","color:darkblue",d,"color:auto")},(nn=t("#settingsFile")).onclick=null,nn.onchange=function(){var n,t,e,o=this.files[0];this.value="",o&&(n=_.Vo.vimSync.iu?102400:10485760,o.size&&o.size>n?alert(s("JSONTooLarge",[o.name,n/1024])):(t=new FileReader,e=o.lastModified||o.lastModifiedDate||0,t.onload=function(){return K(e,this.result,false)},t.readAsText(o)))},(nn=t("#importOptions")).onclick=null,nn.onchange=function(){var n;t("#importButton").focus(),"exported"!==this.value?("../settings_template.json",S>=47?fetch("../settings_template.json").then(function(n){return n.text()}).then(function(n){return K(0,n,true)}):((n=new XMLHttpRequest).open("GET","../settings_template.json",true),n.responseType="text",n.onload=function(){return K(0,this.responseText,true)},n.send())):E(t("#settingsFile"))},nn=null,window.Ts&&(function(){var n,e=window.Ts;delete window.Ts,(n=t(e[0])).onclick&&n.onclick(e[1])})();